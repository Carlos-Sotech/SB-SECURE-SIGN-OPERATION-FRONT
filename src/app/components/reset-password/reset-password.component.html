<div class="auth-page-container">
  <mat-card class="auth-card">
    <mat-card-header>
      <mat-card-title>Restablecer Contraseña</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <!-- Mensaje si el token o email no son válidos -->
      <div *ngIf="!token || !emailFromQuery" class="token-error-container">
        <p class="description-text error-text">{{ errorMessage || 'Enlace no válido o incompleto.' }}</p>
        <a mat-stroked-button color="primary" routerLink="/login" class="full-width" style="margin-top: 10px;">Volver a Iniciar Sesión</a>
      </div>

      <!-- Formulario si el token y email son válidos -->
      <form *ngIf="token && emailFromQuery" [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()">
        <p class="description-text">
          Estableciendo nueva contraseña para <strong>{{ emailFromQuery }}</strong>.
        </p>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nueva Contraseña</mat-label>
          <input matInput [type]="hideNewPassword ? 'password' : 'text'" formControlName="newPassword" required autocomplete="new-password">
          <button mat-icon-button matSuffix (click)="toggleNewPasswordVisibility($event)" [attr.aria-label]="'Toggle new password visibility'" type="button">
            <mat-icon>{{hideNewPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>
          <mat-error *ngIf="fc['newPassword'].touched && fc['newPassword'].errors?.['required']">
            Nueva contraseña es requerida.
          </mat-error>
          <mat-error *ngIf="fc['newPassword'].touched && fc['newPassword'].errors?.['minlength']">
            Debe tener al menos 8 caracteres.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Confirmar Nueva Contraseña</mat-label>
          <input matInput [type]="hideConfirmPassword ? 'password' : 'text'" formControlName="confirmPassword" required autocomplete="new-password">
          <button mat-icon-button matSuffix (click)="toggleConfirmPasswordVisibility($event)" [attr.aria-label]="'Toggle confirm password visibility'" type="button">
            <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>
          <mat-error *ngIf="fc['confirmPassword'].touched && fc['confirmPassword'].errors?.['required']">
            Confirmar contraseña es requerido.
          </mat-error>
          <mat-error *ngIf="resetPasswordForm.errors?.['passwordMismatch'] && (fc['confirmPassword'].touched || fc['newPassword'].touched)">
            Las contraseñas no coinciden.
          </mat-error>
        </mat-form-field>

        <button mat-raised-button color="primary" type="submit" [disabled]="resetPasswordForm.invalid || isLoading" class="full-width">
          <span *ngIf="!isLoading">Restablecer Contraseña</span>
          <mat-spinner *ngIf="isLoading" diameter="24" style="margin: 0 auto;"></mat-spinner>
        </button>
      </form>
    </mat-card-content>

    <!-- Contenedor para mensajes de error del submit del formulario -->
    <div *ngIf="errorMessage && token && emailFromQuery" class="error-message-container">
        <p class="error-text">{{ errorMessage }}</p>
    </div>
  </mat-card>
</div>